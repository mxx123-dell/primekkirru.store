# Bật rewrite
RewriteEngine On
RewriteBase /

# Bảo mật file .env
<Files ".env">
    Require all denied
</Files>

# Nếu không có file hoặc thư mục trùng tên, rewrite về index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# ==============================================
# === ROUTE TRANG CHỦ ==========================
# ==============================================

# Trang chủ (giữ nguyên)
RewriteRule ^$ /index.php?module=client&action=home [L,QSA]

# ==============================================
# === TẤT CẢ TRANG CLIENT ======================
# ==============================================

# Tất cả đường dẫn (ngoại trừ root) đều phải đi qua /client/...
RewriteRule ^client/?$ /index.php?module=client&action=home [L,QSA]
RewriteRule ^client/([A-Za-z0-9-]+)/?$ /index.php?module=client&action=$1 [L,QSA]
RewriteRule ^client/([A-Za-z0-9-]+)/([A-Za-z0-9-]+)/?$ /index.php?module=client&action=$1&id=$2 [L,QSA]

# ==============================================
# === ROUTE ADMIN / CTV / COMMON ===============
# ==============================================

RewriteRule ^admin/(.+)$ /index.php?module=admin&action=$1 [L,QSA]
RewriteRule ^ctv/(.+)$ /index.php?module=ctv&action=$1 [L,QSA]
RewriteRule ^common/(.+)$ /index.php?module=common&action=$1 [L,QSA]

# ==============================================
# === REDIRECT TỰ ĐỘNG =========================
# ==============================================

# Nếu người dùng truy cập /login hoặc /register -> chuyển hướng về /client/login, /client/register
RewriteRule ^login$ /client/login [R=301,L]
RewriteRule ^register$ /client/register [R=301,L]
